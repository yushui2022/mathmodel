回焊炉温曲线优化控制
摘要
回焊炉通过设置各个温区的温度，加热集成电路板，能够将电子元件自动焊接到板子上，在表面贴装工艺技术中起到关键作用。回焊中的焊接区域中心温度变化对产品质量影响尤其重要。本文从物理机理方面入手建立模型，分析了电路板在回焊炉中的温度变化过程，对回焊炉温曲线的优化与控制进行了研究。
对于问题一，首先通过一维稳态传热模型确定回焊炉中各区域的温度分布并结合附件数据考虑区域之间边界处的影响，之后考虑电路板在炉中的温度变化情况，考虑热传导、热对流两种方式，对于升温过程建立基于能量守恒定律的微分方程组，针对不同区域使用不同热时间常数拟合；对于降温过程建立基于牛顿冷却公式的模型，得到对焊接区域中心温度变化曲线的数学模型，利用最小二乘法建立优化模型，拟合实际数据来求解未知参数的最优估计，得到参数对实际数据曲线拟合较好。之后代入第一问新数据计算，绘出了该情况下的炉温变化曲线。得到小温区 3 中点温度为 129.0153°C，小温区 6 中点为 163.9644°C，小温区 7 中点为 174.8322°C 及小温区 8 结束处温度为 207.8417°C。并将每隔 0.5S 的数据存入到 result.csv 中。
对于问题二，根据题目中给出的各温区设定温度值，以题目中的制程界限为约束条件建立非线性规划模型。在题目中给出的传送带过炉速度范围内进行多重搜索的方法，先确定一个大致范围再以小步长进行精细的搜索；对于每一个过炉速度都可以基于第一问中已经得到的机理模型得到炉温曲线，从而可以判断此时的曲线是否满足制程界限。搜索得到的最大过炉速度为 77.85cm/min，此时刚好能满足所有制程界限。
对于问题三，以题目中的制程界限以及各温度区设定温度值和传送带过炉速度的范围限制为约束条件，以炉温曲线超过 217°C 到峰值温度所覆盖的面积为优化目标，建立单目标优化模型来求取面积的最小值。利用模拟退火算法迭代 20000 次进行求解，得到的最优方案为 184.2181°C（小温区 1~5）、189.8133°C（小温区 6）、227.5226°C（小温区 7）、264.0700°C（小温区 8~9），传送带过炉速度为 90.0982cm/min。此时得到的炉温曲线超过 217°C 到峰值温度所覆盖的面积为 406.2318。
对于问题四，在问题三的基础上引入对炉温曲线超过 217°C 部分关于最高温两边对称性的要求。首先定义对称性衡量指标，将最高温两边等量数据点之间的均方差作为衡量指标，结合题目中的制程界限以及各温度区设定温度值和传送带过炉速度的范围限制等约束条件，建立多目标优化模型。将对称度衡量指标与覆盖面积进行处理，选择合适的权值之后，将多目标优化模型转化为单目标优化模型，仍然采用模拟退火算法来求解最优解。得到的最优方案为 183.5822°C（小温区 1~5）、190.5021°C（小温区 6）、227.1962°C（小温区 7）、264.4834°C（小温区 8~9），传送带的过炉速度为 90.1316cm/min，超过 217°C 到峰值温度所覆盖面积为 409.0650，达到了接近最优解的值；得到此时的对称性指标值为 21.6865，此时画出的炉温曲线在 217°C 以上部分近似对称，温度上升斜率和下降斜率略有区别。
最后对模型优缺点进行了分析总结，并对存在的缺点提出了改进方案设想，还提出了推广的方向。
关键词：传热模型；炉温曲线；多重搜索算法；模拟退火算法；多目标优化
一、问题重述
电子信息产业在我国发展迅速，促进了表面贴装工艺（SMT）的技术进步。在集成电路板的生产过程中，要将安装有各种电子元器件的印刷电路板放入回焊炉中进行回流焊，使得电子元器件能够自动地焊接到印刷电路板上。回焊炉中各部分的温度保持对生产产品的质量起到关键的作用。回流焊作为表面贴装工艺的核心工艺环节，主要通过回焊炉的温度曲线优化控制来不断提高生产效率与产品质量。
回焊炉内部从功能角度来划分，主要分为 4 个大温区，分别是预热区、恒温区、回流区和冷却区。运行时将需要加工的电路板放置在回流炉的传送带上，以恒定的速度进入炉中进行加工。本题所考虑的回流炉实际有 11 个长为 30.5cm 的小温区，每个小温区之间有 5cm 的间隙，除此之外有炉外区域包括炉前和炉后区，每个部分长度为 25cm。回焊炉启动后会将各个小区的温度迅速升到指定温度并达到稳定，然后方可进行回焊，而炉外区域、小温区之间间隙不做温度控制，这些区域的温度以及各温区边界温度都受相邻温区的温度影响。生产车间的温度则保持在 25°C。
在设定各温区的温度和传送带的恒定过炉速度后，使用温度传感器来测量焊接区域中心的温度得到一条温度变化的曲线，称之为炉温曲线。温度传感器在被测区域温度超过 30°C 时开始工作。实际生产时为了控制和改善产品质量，需要调节各温区的设定温度以及传送带的过炉速度。某次实验设定的各温区温度为：小温区 1~5 设为 175°C，小温区 6 设为 195°C，小温区 7 设为 235°C，小温区 8~9 设为 255°C，小温区 10~11 设为 25°C。传送带的过炉速度则设置为 70cm/min。焊接区域的厚度设置为 0.15mm。在此基础上，各温区的温度可以进行 10°C 以内的调整，其中小温区 1~5 温度一致、小温区 8~9 温度保持一致、小温区 10~11 温度保持 25°C。传送带的过炉速度可以在 65cm/min~110cm/min 之间变化。在电路板进行回焊操作时，炉温曲线应满足题目中表 1 给出的制程界限，对温度上升斜率、温度下降斜率、温度上升过程中在 150°C~190°C 的时间、大于 217°C 的时间和峰值温度做出了要求。
问题一
建模分析焊接区域的温度变化规律，假设过炉速度调整为 78cm/min，小温区 1~5 设置为 173°C，小温区 6 设置为 198°C，小温区 7 设置为 230°C，小温区 8~9 设置为 257°C，通过模型计算得到焊接区域中心温度变化情况。列出指定位置的焊接区域中心温度，绘制炉温曲线，将每隔 0.5S 的温度数据存放到表格中。
问题二
小温区 1-5 设为 182°C，小温区 6 设为 203°C，小温区 7 设为 237°C，小温区 8-9 设为 254°C，计算允许达到的传送带的最大过炉速度。
问题三
实际过程中焊接区域中心的温度不能太长时间均处于 217°C 以上，峰值温度也不能设的太高。理论上超过 217°C 到峰值温度所覆盖的面积越小，炉温曲线越理想。确定满足此要求的最优炉温曲线，给出各温区的设定温度值以及传送带的过炉速度，给出面积大小。
问题四
焊接过程中希望炉温曲线满足制程界限的同时，尽量使得炉温曲线以峰值温度为中心线的两侧超过 217°C 的部分对称。在问题三的基础上，进一步给出最优炉温曲线。给出各温区的设定温度值以及传送带的过炉速度，和对应的指标值。
二、问题分析
2.1 问题一的分析
对于问题一，需要首先根据题目中给出的各个小温区的设定温度值，来计算稳定状态下回焊炉中各个温区、温区之间的间隙以及炉前区域、炉后区域等的温度分布。通过傅里叶定律推导一维稳态传热过程，确定在温区之间间隙的温度分布以及炉前区域的温度分布等。由题中已给出的区域长度信息，以及传送带的过炉速度，可以计算出在每个小温区和每个间隙经过的时间。
之后对电路板在回流炉中的焊接区域中心温度变化进行分析。利用垂直表面的热流密度与电路板表面积的乘积等于整个电路板得到的热能的关系，由于电路板厚度很小且导热系数很高，可以近似地认为整个电路板的温度相等均匀分布。从而导出一个电路板两面与相同温度热源进行热对流后任意时间的温度公式，因为在每个恒定温度的小温区的经过时间已知，可以得到电路板经过每个小温区后的温度变化情况。之后对于间隙中温度不恒定的情况，采用微分的思想，将间隙划分为很多宽度很小的区域，从而可以近似地认为每个区域温度相等，采用之前导出的公式进行计算。对于降温，采用牛顿冷却模型进行处理，列出常微分方程之后进行离散化处理得到差分方程，从而可以得到冷却时焊接区域中心温度的大致变化情况。
根据上述的模型，代入题目中附件给出的数据进行拟合求反推求解模型中的一些未知的参数。求解过程中发现降温过程中降温速率变化与理论不相符，得出回流区高温可能影响到冷却区的边界附近的温度，在模型中对其进行考虑；发现恒定的热时间常数使得峰值温度无法到达要求范围，了解到热时间常数随温度升高而降低，在模型中考虑不同的温区对应不同的热时间常数。修正模型之后根据数据再次拟合，得到模型中未知量（热时间常数、对流系数等）的值。
根据已经求得的模型，代入第一问中的新的各个温区的温度和传送带的过炉速度进行计算，从而得到焊接区域中心温度的变化情况，得到题目中要求的一些参数。
2.2 问题二的分析
问题二给出了各温区的设定温度，要求在此基础上确定允许的最大传送带过炉速度。这是一个非线性规划问题，目标是求出传送带过炉速度的最大值，约束条件是题目中所给的制程界限。传送带的过炉速度调节范围为 65~100cm/min，利用多重搜索算法，先设定较大的搜索步长，确定速度的大致范围，再设置较小的搜索步长进行精确搜索。对于每一个搜索的过炉速度值，利用问题一解得的模型，都能得到对应的炉温曲线图，以及各个时间点焊接区域中心的温度。判断当前的炉温曲线能否满足约束条件，若满足则保留当前的过炉速度值，否则舍去，直到搜索结束，找到最大的满足约束条件的过炉速度大小。
2.3 问题三的分析
问题三需要给出最优炉温曲线，以及各温区的设定温度和传送带的过炉速度，使得超过 217°C 到峰值温度所覆盖的面积最小。这是一个优化问题，优化目标是求覆盖面积的最小值，约束条件一是题目中所列出的制程界限，二是各温区设定温度及传送带的过炉速度调节范围限制。通过以上分析建立优化模型，以各温区的设定温度和传送带过炉速度为变量，利用模拟退火算法进行求解。
2.4 问题四的分析
问题四需要在第三问的基础上，进一步考虑炉温曲线在 217°C 以上的部分升温 和降温的过程尽量对称，同时要保证符合制程界限与各温区设定温度及传送带过炉速度 调节范围的限制，并使得超过 217°C 到峰值温度所覆盖的面积仍能达到一个较小值。这是一个多目标优化问题，一个目标是覆盖的面积，一个目标是曲线的对称度。一般可以为要优化的目标分配权值后再进行优化。首先要给出一个衡量对称度的量，取炉温曲线在 217°C 以上的部分，取最高温对应的时间和两个边界时间点，将两个边界时间点相减除以时间步长得到数据点总数，以最高温对应的时间点向时间正方向和负方向各取数据点总数的一半的数据，取正负方向各个对应点的温度值求均方差值，作为对称度衡量的指标。将面积和对称度数量级进行处理，使得两者的数量级一致，为两个因素分配合理的权值之后，得到一个多目标的优化模型，以各温区的设定温度和传送带过炉速度为变量，同样使用模拟退火算法来进行求解。
三、模型假设
假设观测误差、随机误差和连续问题离散化所产生的误差对本题的计算是没有影响的。
在回焊炉中传热方式仅考虑热传导、热对流，假设热辐射对本题结果的计算没有影响。
假设回焊炉温度高于室内温度的区域（即加热区域）的温度能够保持不变，每个温区内的温度均匀分布。
四、符号说明及名词定义
符号	含义
T 
i
​
 (i=1,2,3,4,5)
各个温区的设定温度
T
焊接区域中心温度
τ 
1
​
 ,τ 
2
​
 
两个温区分别对应的热时间常数
h
热对流系数
v
传送带过炉速度
t 
i
​
 (i=1,2,3,4,5)
5 个特定温度的对应时间值（详见第六节）
S
炉温曲线超过
217 
∘
 C
到峰值温度覆盖面积
五、问题一模型建立与求解
5.1 模型建立
5.1.1 模型准备
首先需要准备一定的物理背景，本文中主要用到的热力学过程中的基本传热方式为热传导和热对流。热传导是指微观的粒子热运动所导致的热能传递，在固体、液体、气体中内部传热时都会产生热传导现象。热对流是指由流体宏观的运动引起的能量传递，在流体与物体的接触面会产生热交换。传热过程可以分为稳态和非稳态两种，区别在于稳态传热过程各点温度不随时间变化，而非稳态传热中各点温度随时间变化，其控制方程中含有时间因子。
对于热传导，通常使用傅里叶传热定律来建立模型，描述了温度与热的关系。
q=−λ 
dx
dT
​
 (5−1)
其中
q
代表热流密度，
λ
代表传热系数，
dx
dT
​
 
代表空间上两点之间的温度差。
对于热对流，通常使用牛顿冷却公式来建立模型，描述了流体与物体表面换热的过程关系。
q=hΔT(5−2)
其中
h
代表对流换热系数，
ΔT
代表流体与物体表面温度差。
5.1.2 整体模型算法流程
建立第一问的模型算法流程图（如图 1 所示），展示求解整个回流焊炉温曲线的过程。
加热模型→求出回焊炉的环境温度分布模型→建立焊接区域中心温度变化模型→对加热时间常数进行改进→冷却模型→利用建立的模型解决问题→最小二乘进行参数拟合
图 1、整体模型算法流程图
5.1.3 温度分布模型
由题目中的条件，当回焊炉启动后，炉内的空气会在很短时间内达到稳定状态，因而对于已经设置各小温区温度的回流炉中的温度分布问题，可以当做一个稳态传热问题来考虑。而对于不做特殊温度控制的各小温区的间隙部分和炉前区域，主要受相邻的温区温度的影响。对间隙温度分布作如下分析：
如图 2 所示，将一块平板的两侧分别置于均匀恒定温度
t 
1
​
 
和
t 
2
​
 
，则平板内任意截面热流密度
q
相同。利用傅里叶定律，有
∫ 
0
δ
​
 qdx=−λ∫ 
t 
1
​
 
t 
2
​
 
​
 dt
由此得到的热流密度后，导出温度分布为
t 
1
​
 −t 
2
​
 
t−t 
2
​
 
​
 =1− 
δ
x
​
 
可得平板内沿导热方向面积不变，热流密度不变，温度分布呈线性分布。所以在之后的模型中，认为在炉前区域和温区之间的间隙部分，温度应按线性分布。
图 2、平板稳态导热示意图
5.1.4 焊接区域中心温度变化模型
对于回流炉中某个特定的功能温区，电路板在该区域中受热升温的模型如图 3 所示。由于电路板的长度或宽度远远大于电路板的厚度，认为电路板的升温主要受垂直方向的热流影响，将水平方向的热流影响忽略不计。由于电路板的材质一般为金属，导热系数很大，且题中所给的电路板厚度很薄，因此假设整块电路板的温度近似均匀分布。
图 3、回流炉中对流加热模型示意图
其中电路板的面积记为
A
，热源的温度为
T 
i
​
 (i=1,2,3,4,5)
，其中
i=1
时代表小温区 1~5，
i=2
代表小温区 6，
i=3
代表小温区 7，
i=4
代表小温区 8~9，
i=5
代表小温区 10~11，它们代表了各温区初始设定的温度值。电路板的温度即焊接区域中心温度为
T
。
由热流密度与电路板面积的乘积可以得到电路板吸收的能量，而电路板吸收的热能导致了整块电路板升温现象，列出等式：
dQ=hA(T 
i
​
 −T)dt=ρC 
p
​
 VdT(5−5)
其中
h
代表炉内空气与电路板的对流系数。对 (5-5) 式两边积分，并假设电路板初始的温度为
T 
s
​
 
，加热一段时间后的温度为
T 
c
​
 
。
∫ 
0
t
​
  
ρC 
p
​
 V
hA
​
 dt=−∫ 
T 
s
​
 
T 
c
​
 
​
  
T 
i
​
 −T
d(T 
i
​
 −T)
​
 
解得
T 
i
​
 −T 
s
​
 
T 
c
​
 −T 
s
​
 
​
 =1−e 
− 
ρC 
p
​
 V
hAt
​
 
 
T 
c
​
 =T 
s
​
 +(T 
i
​
 −T 
s
​
 )(1−e 
− 
ρC 
p
​
 V
hAt
​
 
 )
设
τ= 
hA
ρC 
p
​
 V
​
 
为热时间常数，则
T 
c
​
 =T 
s
​
 +(T 
i
​
 −T 
s
​
 )(1−e 
−t/τ
 )
根据 (5-9) 式，由于题中已给出各个温区的分布，可以得到每个温区的温度和长度，由于已知传送带的传送速度，可以计算电路板在每个温区内的时间，因而可以计算电路板在经过每个温区后达到的温度。
对于小温区之间的间隙，将间隙划分为很小的区域，这样可以近似认为每个小区域内的温度保持恒定不变，那么也可以采用上式计算出电路板经过每个小区域后的温度，累加之后就可以计算电路板通过变温的间隙时所发生的温度变化。
考虑到电路板升温降温的机理可能有所差异，为降温过程另外选取一个模型进行计算。采用牛顿冷却公式建立模型。
将降温过程时间分为很小的时间段，使用可以通过已知的数据对这些参数进行拟合，求解出合适的数值。
5.2 模型求解
5.2.1 模型改进
在求解过程中发现了模型中的两个不足之处，因此对上述模型进行一些修改。
第一是在拟合降温时的温度曲线时发现，电路板在进入冷却区后（小温区 10~11）的降温速率并不是最大的，而是在过了一段时间之后才达到最大值，这与温度差越大降温速率越大的理论是不符合的。进行分析并查询相关资料后，认为可能是冷却区中第一个小温区的冷却能力不够强，导致炉内温度降低速率不够快，因而造成第一个小温区（小温区 10）的边界附近温度受到回流区的温度影响，在边界附近炉内温度还处于较高水平，因而与电路板之间温差较小，从而降温速率较小；而后炉内温度逐渐降低，与电路板之间温差变大，因而导致降温速率在加快。考虑回流区的温度最多影响到第一个小温区的一半位置，将之前的区域使用与温区之间间隙同样的求解方法进行处理，能够比较好地拟合降温的温度曲线，从而证明了这个想法的正确性，拟合结果将在文中之后部分说明。
第二是从文献 [1] 中发现之前定义的加热的时间常数
τ
，在工程热物理学中，被认为是一个具有时间量纲的热时间常数，是一个取决于诸多因素的函数，它反映了被加热物体（电路板）对热源温度的响应快慢，值越小则对温度响应越快，升温越快。它不仅仅取决于加热物体本身，也是可以受诸如喷嘴喷出的冲击射流气体与电路板间的热交换特性等因素影响，因而在加热过程中可能不是一个恒定的值。在原本的模型中，若保持
τ
的值不变，在电路板温度达到较高的时候（回流区时），此时电路板对环境温度的响应较慢，会出现峰值温度无法达到指定要求范围的情况，这就是因为没有考虑到热时间常数的变化所导致的。当温度升高时，热时间常数一般会变小，从而能够响应更高的环境温度。为了方便计算，在小温区 1~6 升温过程对应一个时间常数
τ 
1
​
 
，在小温区 7~9 升温对应另一个时间常数
τ 
2
​
 
，利用 (5-9) 式，对题中给出的附件数据进行拟合。
5.2.2 模型求解与结果
通过题目中附件给出的数据，能够画出一条满足题中条件（
T 
1
​
 =175 
∘
 C
、
T 
2
​
 =195 
∘
 C
、
T 
3
​
 =235 
∘
 C
、
T 
4
​
 =255 
∘
 C
、
T 
5
​
 =25 
∘
 C
，传送带的过炉速度为 70cm/min）的炉温曲线。而若给定
τ 
1
​
 
、
τ 
2
​
 
、
h
的值，根据上述的模型，也能够画出一条炉温曲线，并得到对应的数据。通过最小二乘法，来建立参数估计的模型。
( 
τ
^
  
1
​
 , 
τ
^
  
2
​
 , 
h
^
 )= 
τ 
1
​
 ,τ 
2
​
 ,h
argmin
​
 ∑ 
n=1
N
​
 [T(t 
n
​
 ;τ 
1
​
 ,τ 
2
​
 ,h)−T 
0
​
 (t 
n
​
 )] 
2
 
其中
T(t 
n
​
 ;τ 
1
​
 ,τ 
2
​
 ,h)
代表给定三个参数值之后，对于每个时间点求出的炉温值。而
T 
0
​
 (t 
n
​
 )
代表题目附件中给出的每个时间点对应的炉温数据。
通过搜索三个未知的系数来求解附件中给出的炉温曲线的最佳拟合方式。求解具体步骤大致为：
STEP1：给定
τ 
1
​
 
、
τ 
2
​
 
、
h
的初始搜索范围，步长分别设置为
10 
−5
 
等；
STEP2：代入三个参数的初始值，通过上述模型进行求解得到整个过程的炉温数据；
STEP3：求解计算得到的炉温数据与附件给出的测量数据的误差，求出其平方和；
STEP4：重复上述步骤，在一定范围内搜索寻优找到能够实现对附件中给出的炉温曲线拟合最好的两个热时间常数和对流热系数。
通过上述的方法进行求解，得到的
τ 
1
​
 =57.4s
，
τ 
2
​
 =43.7s
，
h=0.00678W/mm 
2
 ⋅ 
∘
 C
。得到的炉温曲线与附件中给出的炉温曲线如图 4 所示（其中升温之前一段水平是指刚进入炉前区域，此时环境温度仍保持在 25°C 左右，因此没有升温）。
图 4、拟合曲线与附件中数据给出曲线的对比情况
从图 4 中可以看到，在升温过程中，所得到的模型结果与实际数据中给出的炉温曲线拟合情况较好。但是在降温的过程中，温度下降的速度略慢于实际数据的下降速度，从而在曲线上有一些差异。鉴于题目中给出的制程界限，其中对温度下降速率有一定的限制，而模型得到的曲线在降温的时候较为平缓，可以认为模型也有合理之处，可以更好地满足这个下降速率的限制。
当传送带过炉速度为 78cm/min，各温区温度的设定值更改为
T 
1
​
 =173 
∘
 C
、
T 
2
​
 =198 
∘
 C
、
T 
3
​
 =230 
∘
 C
、
T 
4
​
 =257 
∘
 C
、
T 
5
​
 =25 
∘
 C
。将这些数据代入到模型中进行计算，得到在该情况下的焊接区域中心温度变化曲线，即炉温曲线，如图 5 所示。
图 5、第一问条件下的炉温曲线
该炉温曲线达到的峰值温度为 242.2832°C，且升温和降温的斜率都没有超过 3°C/S，均符合制程限制中的条件。
对于题中所要求的几个特殊位置的温度值，结果如表 1 所示。
表 1、几个特殊位置的炉温值表
位置	温度 /°C
小温区 3 中点	129.0153
小温区 6 中点	163.9644
小温区 7 中点	174.8322
小温区 8 结束处	207.8417
每隔 0.5s 焊接区域中心的温度存入了 result.csv 中，可以从提供的支撑材料中查看结果。
六、问题二模型建立与求解
6.1 模型建立
设定各区的温度为
T 
1
​
 =182 
∘
 C
、
T 
2
​
 =203 
∘
 C
、
T 
3
​
 =237 
∘
 C
、
T 
4
​
 =254 
∘
 C
、
T 
5
​
 =25 
∘
 C
。在此条件下需要求出允许的最大传送带过炉速度
v
。首先由题意可知，
v
的调节范围是 65~100cm/min，即：
65cm/min≤v≤100cm/min(6−1)
之后通过多重搜索法对允许的速度
v
的最大值进行搜索。对于每一个搜索值，利用问题一中建立的模型，都可以得到焊接区域的温度变化规律。当前所得到的炉温需要满足如下的约束条件：
​
  
Δt
T 
i
​
 −T 
i−1
​
 
​
  
​
 ≤3(6−2)
60≤t 
2
​
 −t 
1
​
 ≤120(6−3)
40≤t 
5
​
 −t 
3
​
 ≤90(6−4)
240≤T(t 
4
​
 )≤250(6−5)
其中，
T(i)
表示对炉温曲线离散化处理之后第
i
时刻的温度，
Δt
表示对炉温曲线离散化的步长。
t 
1
​
 
、
t 
2
​
 
、
t 
3
​
 
、
t 
4
​
 
、
t 
5
​
 
满足以下条件：
T(t 
1
​
 )=150(6−6)
T(t 
2
​
 )=190(6−7)
T(t 
3
​
 )=T(t 
5
​
 )=217(6−8)
T(t 
4
​
 )=max[T(t)](6−9)
先设置较大的步长对
v
进行搜索，找到满足约束条件的
v
的最大值。再设置较小的步长，对那个最大值向后进行更精确的搜索，最终得到较准确的
v
值。
6.2 模型求解
运用多重搜索算法对传送带的过炉速度
v
进行两次搜索，第一次得到过炉速度
v
最大值的大致值，第二次在前面求得的最大值附近以更小的步长搜索，得到其精确值。
STEP1 初步搜索
以 1cm/min 为步长，在 [65cm/min,100cm/min] 内进行搜索。对于每一个搜索值
v
，利用问题一的模型，都可以得到一个对应的炉温曲线。之后判断此炉温曲线是否满足约束条件，若满足则将最大值更新，否则不更新。最终得到满足条件的传送带的过炉速度
v
最大值为 77cm/min，由此进行第二次搜索。
STEP2 精确搜索
在 [76cm/min, 78cm/min] 的范围内，以 0.01cm/min 为步长对
v
的最大值进行搜索。最终得到满足条件的
v
最大值为 77.85cm/min。
此时的炉温变化曲线如下图 6 所示：得到的峰值温度约为 240.04°C，得到温度上升过程中在 150°C-190°C 的时间为 82.19S，温度大于 217°C 的时间为 67.40S，最大的温度上升斜率和温度下降斜率均未超过 ±3°C 的范围，均符合题目中的制程界限，可以认为 77.85cm/min 为此时最大的传送带过炉速度。
图 6、过炉速度 = 77.85cm/min 时的炉温曲线
七、问题三模型建立与求解
7.1 模型建立
问题三的优化目标是炉温曲线温度上升过程中超过 217°C 到峰值温度所覆盖的面积
S
取到最小值，如下图 7 中阴影部分所示，变量是各温区的设定温度
T 
i
​
 (i=1,2,3,4,5)
和传送带过炉速度
v
，共五个自变量。
图 7、峰值温度覆盖面积示意图
其中
S
的计算公式为
S=∫ 
t 
3
​
 
t 
4
​
 
​
 T(t)dt−217(t 
4
​
 −t 
3
​
 )(7−1)
根据题目中给出的制程界限以及各温区设定温度值与传送带过炉速度的限制范围，可以综合建立炉温曲线超过 217°C 到峰值温度覆盖面积的优化模型：
minS(7−2)
s.t. 
⎩
⎨
⎧
​
  
​
  
Δt
T 
i
​
 −T 
i−1
​
 
​
  
​
 ≤3
60≤t 
2
​
 −t 
1
​
 ≤120
40≤t 
5
​
 −t 
3
​
 ≤90
240≤T(t 
4
​
 )≤250
165≤T 
1
​
 ≤185
185≤T 
2
​
 ≤205
225≤T 
3
​
 ≤245
245≤T 
4
​
 ≤265
65≤v≤100
​
 
其中
t 
1
​
 
、
t 
2
​
 
、
t 
3
​
 
、
t 
4
​
 
、
t 
5
​
 
仍然满足 (6-6) 到 (6-9) 式的要求。
7.2 模型求解
7.2.1 模拟退火算法
对于该优化模型，可以采用模拟退火智能算法来求解。
在利用模拟退火算法对该优化问题之前，先对该优化算法进行简述。模拟退火算法是一种基于蒙特卡洛迭代求解策略的随机寻优算法，出发点是基于固体物质的退火过程与一般组合优化问题之间的相似性。它是局部搜索算法的扩展，以一定的概率选择领域中目标值较大的状态，从而达到求解全局优化问题的目的。判断新解是否接受的依据一般为 Metropolis 准则：
若
ΔE<0
，则接受新解；
否则接受新解的概率由下式确定：
p=e 
−ΔE/T
 <1(7−3)
模拟退火算法的流程图如图 8 所示。
图 8、模拟退火算法流程图
7.2.2 模型结果
利用模拟退火算法对上述优化模型进行计算。选取迭代次数为 20000 次，得到迭代次数与优化目标的变化如下图 9 所示：
图 9、优化目标值随迭代次数变化图
从图中可以看出，随着迭代次数的增加，优化目标先快速下降，而后变化逐渐趋缓，在迭代约 8300 次后优化目标已经达到比较好的结果。此时的炉温曲线超过 217°C 到峰值温度覆盖面积达到了最小值。各参变量的结果如表 2 所示。
表 2、模拟退火求解结果表
T 
1
​
 
/°C	
T 
2
​
 
/°C	
T 
3
​
 
/°C	
T 
4
​
 
/°C	
v
/（cm/min）	面积
S
184.2181	189.8133	227.5226	264.0700	90.0982	406.2318
在上述条件下，焊接区域中心的温度超过 217°C 的时间为 53.49s，峰值温度为 240.1371°C，满足题中 “焊接区域中心的温度超过 217°C 的时间不宜过长，峰值温度也不宜过高” 的条件。
八、问题四模型建立与求解
8.1 模型建立
在第三问的基础上，第四问要增加考虑要使得以峰值温度为中心线的两侧超过 217°C 的炉温曲线应尽量对称的目标，首先为曲线超过 217°C 温度线部分的对称程度定义一个指标。
首先通过设定各小温区的温度以及传送带的过炉速度，能够得到一条确定的炉温曲线，能够得到温度到达 217°C 的两个边界时间
t 
3
​
 
和
t 
5
​
 
，满足 (6-8) 的要求。并能够得到取到最高温的时间，即上文中提到的
t 
4
​
 
，满足 (6-9) 的要求。然后，以
t=t 
4
​
 
为对称轴，两边对称各取
n
组数据进行比较。
n
值的计算公式为
n=floor[[(t 
4
​
 −t 
3
​
 )+(t 
5
​
 −t 
4
​
 )]/(2Δt)](8−1)
其中
Δt
代表所取的时间步长。
对称度通过两边对应点温度均方差来衡量，通过下式来计算：
l= 
n
∑ 
i=1
n
​
 (T(t 
+
i
​
 )−T(t 
−
i
​
 )) 
2
 
​
 (8−2)
其中
T(t 
+
i
​
 )
代表对称轴右侧距对称轴的第
i
组数据，
T(t 
−
i
​
 )
代表对称轴左侧距对称轴的第
i
组数据。
合理调整面积
S
和对称度指标
l
的数量级，将其调整至同一数量级大小，分别记为
S
^
 
和
l
^
 
，选取合适的权值考虑两者的影响程度，由此建立优化模型。
minw 
1
​
  
S
^
 +w 
2
​
  
l
^
 (8−3)
s.t. 
⎩
⎨
⎧
​
  
​
  
Δt
T 
i
​
 −T 
i−1
​
 
​
  
​
 ≤3
60≤t 
2
​
 −t 
1
​
 ≤120
40≤t 
5
​
 −t 
3
​
 ≤90
240≤T(t 
4
​
 )≤250
165≤T 
1
​
 ≤185
185≤T 
2
​
 ≤205
225≤T 
3
​
 ≤245
245≤T 
4
​
 ≤265
65≤v≤100
​
 
8.2 模型求解
同样使用上一问的模拟退火算法，仅需将原来的适应度函数改成上述的加权后的优化目标，将迭代次数设置为 50000 次，进行计算，得到迭代次数与加权后的优化目标值的变化关系图如图 10 所示。
图 10、加权后优化目标值随迭代次数变化图
可以看到加权后的优化目标值在开始迭代后迅速下降，之后降速趋缓，在迭代约 43000 次后得到最优解。得到各参变量的结果如表 3 所示。
表 3、第四问模拟退火求解结果表
T 1/°C	T 2/°C	T 3/°C	T 4

 
/°C	
v
/（cm/min）	面积
S
对称度指标
l
183.5822	190.5021	227.1962	264.4834	90.1316	409.0650	21.6865
此时面积
S
与第三问中的最优解相差比较小，而对称度
l
经过对一些炉温曲线的估计之后发现此时达到的 21.6865 也处于比较好的水平。画出此时的炉温曲线如图 11 所示。可以发现，此时的炉温曲线在 217°C 以上的部分近似对称，在升温过程的斜率绝对值略小于降温过程的，但是此时两边对应点的均方差达到了很小的值，且炉温曲线超过 217°C 到峰值温度覆盖面积也达到了较小的数值，因此这个求解结果还是比较好的。
图 11、第四问最优解炉温曲线示意图
九、模型评价与推广
9.1 模型优点
在问题一中，选取了两个不同的方法来分别建立焊接区域中心的加热和冷却模型，使得模型更加贴近实际。
问题二利用了多重搜索法，减少了运算量，可以较快地解决问题。
问题三和四利用了模拟退火算法，避免搜索结果进入局部最优解。
在求解模型时，设置时间步长为 0.01s，取值较小，使得计算的精度更大。
9.2 模型缺点与改进
没有考虑 PCB 板厚度，即热量从表面传热到中心的过程，对模型会产生一定的影响。
对于温度下降冷却阶段，曲线拟合较差，因为没有准确推导从高温区转到低温区的温度分布，导致拟合出现误差。
对于模拟退火算法解决的第三四两问，运算量较大，算法耗时较长，可能尚未搜寻到最优解，不能迅速准确地得到问题结果。
可能的改进方案首先是对于物理机理层面利用差分方程推导出环境的温度分布，以及 PCB 板表面到中心的温度分布。对于优化算法层面，可以使用改进的模拟退火或者遗传算法等一系列算法，提高运算速度，并且能够更加准确找到全局的一个最优解。
9.3 模型推广
本文对回焊炉中电路板的加热过程做了较为完整的分析，综合考虑了回焊炉中可能对炉温曲线带来影响的多种因素，包括热时间常数的变化以及区域间的温度影响等，因而对于实际操作控制有一定的借鉴意义。从文献中了解到在回焊炉加工的物品中加装温度传感器，实时测定焊接区域中心温度，并以此改变回焊炉各区域的温度设定以及过炉速度等，能够更好地满足电路板的加工要求，提高生产产品的质量，本文中的研究能为这种技术的理论研究提供一些帮助。
十、参考文献
[2] J.Lempinen and A. Tuominen, "Evaluation of Reflow Ovens for Lead-Free Soldering," 2006 25th International Conference on Microelectronics, Belgrade, 2006, pp. 609-612, doi: 10.1109/ICMEL.2006.1651040.
[3] 李友荣、吴双应、石万元、崔文智等，传热分析与计算 [J], 中国电力出版社，2013.
[4] 赵镇南，传热学 (第二版)[M], 高等教育出版社，2008.
[5] 包子阳、余继周、杨杉，智能优化算法及其 MATLAB 实例 (第 2 版)[M], 电子工业出版社，2017.